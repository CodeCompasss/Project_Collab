(()=>{var e={};e.id=722,e.ids=[722],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7462:(e,t,o)=>{"use strict";o.a(e,async(e,r)=>{try{o.d(t,{db:()=>g});var a=o(97329),s=o(72094),n=o(64939),i=o(13723),c=e([n,s]);if([n,s]=c.then?(await c)():c,a.config({path:".env.local"}),!process.env.DATABASE_URL)throw Error("âŒ DATABASE_URL not set in .env.local");let p=new n.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}}),g=(0,s.fd)(p,{schema:i});r()}catch(e){r(e)}})},8727:(e,t,o)=>{"use strict";o.a(e,async(e,r)=>{try{o.r(t),o.d(t,{DELETE:()=>l,GET:()=>p,POST:()=>g,PUT:()=>d});var a=o(32190),s=o(7462),n=o(13723),i=o(94634),c=e([s]);async function p(){try{let e=await s.db.select().from(n.categories).execute(),t=await Promise.all(e.map(async e=>{let t=[];return t=await s.db.select({optionId:n.categoryOptionValues.optionId,optionName:n.categoryOptionValues.optionName}).from(n.categoryOptionValues).where((0,i.eq)(n.categoryOptionValues.categoryId,e.categoryId)).execute(),{categoryId:e.categoryId,categoryName:e.category,options:t.filter(e=>null!==e.optionName)}}));return a.NextResponse.json(t)}catch(e){return console.error("Error fetching categories:",e),a.NextResponse.json({message:"Failed to fetch categories",error:e instanceof Error?e.message:String(e)},{status:500})}}async function g(e){try{let{categoryName:t,options:o}=await e.json();if(!t)return a.NextResponse.json({message:"Category name is required."},{status:400});let[r]=await s.db.insert(n.categories).values({category:t}).returning({categoryId:n.categories.categoryId});if(o&&o.length>0&&r&&r.categoryId)for(let e of o)e.optionName&&await s.db.insert(n.categoryOptionValues).values({optionName:e.optionName,categoryId:r.categoryId}).execute();return a.NextResponse.json(r,{status:201})}catch(e){return console.error("Error adding category:",e),a.NextResponse.json({message:"Failed to add category.",error:e instanceof Error?e.message:String(e)},{status:500})}}async function d(e){try{let{categoryId:t,categoryName:o,options:r}=await e.json();if(console.log("PUT /api/categories - Incoming data:",{categoryId:t,categoryName:o,options:r}),!t||!o)return console.error("Validation Error: Category ID or name missing for update.",{categoryId:t,categoryName:o}),a.NextResponse.json({message:"Category ID and name are required for update."},{status:400});let[c]=await s.db.update(n.categories).set({category:o}).where((0,i.eq)(n.categories.categoryId,t)).returning();if(console.log("PUT /api/categories - Updated category result:",c),!c)return console.error("Category Not Found: No category found with ID:",t),a.NextResponse.json({message:"Category not found."},{status:404});let p=Array.isArray(r)?r:[];if(p.length>0){console.log("PUT /api/categories - Deleting existing project options for categoryId:",t),await s.db.delete(n.projectOptions).where((0,i.eq)(n.projectOptions.categoryId,t)),console.log("PUT /api/categories - Existing project options deleted."),console.log("PUT /api/categories - Deleting existing category options for categoryId:",t),await s.db.delete(n.categoryOptionValues).where((0,i.eq)(n.categoryOptionValues.categoryId,t)),console.log("PUT /api/categories - Existing category options deleted.");let e=[];for(let o of p)o.optionName&&e.push({optionName:o.optionName,categoryId:t});e.length>0?(console.log("PUT /api/categories - Inserting new options:",e),await s.db.insert(n.categoryOptionValues).values(e).execute(),console.log("PUT /api/categories - New options inserted.")):console.log("PUT /api/categories - No valid options to insert.")}else 0===p.length&&void 0!==r?(console.log("PUT /api/categories - Options array is empty, deleting all existing project options and category options."),await s.db.delete(n.projectOptions).where((0,i.eq)(n.projectOptions.categoryId,t)),await s.db.delete(n.categoryOptionValues).where((0,i.eq)(n.categoryOptionValues.categoryId,t))):console.log("PUT /api/categories - No options provided or options is not an array. Skipping option updates.");return a.NextResponse.json({message:"Category updated successfully."})}catch(e){return console.error("Error updating category:",e),a.NextResponse.json({message:"Failed to update category.",error:e instanceof Error?e.message:String(e)},{status:500})}}async function l(e){try{let{categoryId:t}=await e.json();if(!t)return a.NextResponse.json({message:"Category ID is required for deletion."},{status:400});await s.db.delete(n.projectOptions).where((0,i.eq)(n.projectOptions.categoryId,t)),await s.db.delete(n.categoryOptionValues).where((0,i.eq)(n.categoryOptionValues.categoryId,t));let[o]=await s.db.delete(n.categories).where((0,i.eq)(n.categories.categoryId,t)).returning();if(!o)return a.NextResponse.json({message:"Category not found."},{status:404});return a.NextResponse.json({message:"Category deleted successfully."})}catch(e){return console.error("Error deleting category:",e),a.NextResponse.json({message:"Failed to delete category.",error:e instanceof Error?e.message:String(e)},{status:500})}}s=(c.then?(await c)():c)[0],r()}catch(e){r(e)}})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13723:(e,t,o)=>{"use strict";o.r(t),o.d(t,{categories:()=>d,categoryOptionValues:()=>y,projectOptions:()=>m,projects:()=>l,teamMembers:()=>u,users:()=>g});var r=o(43402),a=o(79252),s=o(50033),n=o(29334),i=o(9253),c=o(14082),p=o(63431);let g=(0,r.cJ)("users",{uid:(0,a.yf)("uid",{length:255}).primaryKey(),userRole:(0,a.yf)("user_role",{length:50}).notNull()}),d=(0,r.cJ)("categories",{categoryId:(0,s.vX)("category_id").primaryKey(),category:(0,a.yf)("category",{length:100}).notNull()}),l=(0,r.cJ)("projects",{projectId:(0,s.vX)("project_id").primaryKey(),projectName:(0,a.yf)("project_name",{length:255}).notNull(),projectDescription:(0,n.Qq)("project_description"),projectLink:(0,a.yf)("project_link",{length:255}),createdAt:(0,i.vE)("created_at").defaultNow(),createdByUid:(0,a.yf)("created_by_uid",{length:255}),customDomain:(0,a.yf)("custom_domain",{length:255}),contactInstagram:(0,a.yf)("contact_instagram",{length:255}),contactLinkedIn:(0,a.yf)("contact_linkedin",{length:255}),contactEmail:(0,a.yf)("contact_email",{length:255}),contactWhatsApp:(0,a.yf)("contact_whatsapp",{length:255})},e=>({fk_createdBy:(0,c.mt)({columns:[e.createdByUid],foreignColumns:[g.uid]})})),u=(0,r.cJ)("team_members",{memberId:(0,s.vX)("member_id").primaryKey(),projectId:(0,p.nd)("project_id"),name:(0,a.yf)("name",{length:100}),linkedin:(0,a.yf)("linkedin",{length:255})},e=>({fk_projectId:(0,c.mt)({columns:[e.projectId],foreignColumns:[l.projectId]})})),y=(0,r.cJ)("category_option_values",{optionId:(0,s.vX)("option_id").primaryKey(),optionName:(0,a.yf)("option_name",{length:255}).notNull(),categoryId:(0,p.nd)("category_id")},e=>({fk_categoryId:(0,c.mt)({columns:[e.categoryId],foreignColumns:[d.categoryId]})})),m=(0,r.cJ)("project_options",{id:(0,s.vX)("id").primaryKey(),projectId:(0,p.nd)("project_id"),categoryId:(0,p.nd)("category_id"),optionId:(0,p.nd)("option_id")},e=>({fk_projectId:(0,c.mt)({columns:[e.projectId],foreignColumns:[l.projectId]}),fk_categoryId:(0,c.mt)({columns:[e.categoryId],foreignColumns:[d.categoryId]}),fk_optionId:(0,c.mt)({columns:[e.optionId],foreignColumns:[y.optionId]})}))},21820:e=>{"use strict";e.exports=require("os")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47922:(e,t,o)=>{"use strict";o.a(e,async(e,r)=>{try{o.r(t),o.d(t,{patchFetch:()=>p,routeModule:()=>g,serverHooks:()=>u,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var a=o(96559),s=o(48088),n=o(37719),i=o(8727),c=e([i]);i=(c.then?(await c)():c)[0];let g=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/categories/route",pathname:"/api/categories",filename:"route",bundlePath:"app/api/categories/route"},resolvedPagePath:"/home/shadilrayyan/code/codecomapass/Project_Collab/app/api/categories/route.ts",nextConfigOutput:"standalone",userland:i}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:u}=g;function p(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}r()}catch(e){r(e)}})},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:e=>{"use strict";e.exports=import("pg")},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[719,996,190],()=>o(47922));module.exports=r})();