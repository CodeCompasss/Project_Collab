(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[631],{1988:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),l=a(2115),r=a(2058);function o(){let[e,t]=(0,l.useState)([]),[a,o]=(0,l.useState)(!0),[n,i]=(0,l.useState)(null),[d,c]=(0,l.useState)(!1),[m,u]=(0,l.useState)(null),[g,x]=(0,l.useState)(!1),[h,y]=(0,l.useState)(null),[p,f]=(0,l.useState)(null);(0,l.useEffect)(()=>{b()},[]);let b=async()=>{let e="cachedCategories",a=localStorage.getItem(e);if(a){let{data:e,timestamp:s}=JSON.parse(a);if(Date.now()-s<36e5){t(e),o(!1),console.log("Categories loaded from cache in manage-categories.");return}}try{let a=await fetch("/api/categories");if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let s=await a.json();t(s),console.log("Categories fetched and set:",s),localStorage.setItem(e,JSON.stringify({data:s,timestamp:Date.now()}))}catch(e){i(e.message),console.error("Failed to fetch categories:",e)}finally{o(!1)}},w=e=>{u({...e}),c(!0)},N=e=>{y(e),x(!0),f("none")},j=async function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null===h)return;let s=!1;try{let l=await fetch("/api/categories",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoryId:h,forceDelete:a})});if(!l.ok){let e=await l.json().catch(()=>({message:l.statusText,code:null})),t=e.message||l.statusText,a=e.code;if(t.includes("violates foreign key constraint")||"23503"===a){f("foreignKeyBlocked"),i("This deletion affects the database, because this category is used in some projects. If you want to delete the category, remove the category from the projects and then delete the category.");return}throw Error("HTTP error! status: ".concat(l.status," - ").concat(t))}localStorage.removeItem("cachedCategories"),t(e.filter(e=>e.categoryId!==h)),b(),s=!0}catch(e){i(e.message||"An unexpected error occurred."),console.error("Failed to delete category:",e),x(!1),y(null),f("none")}finally{s&&(x(!1),y(null),f("none"))}},v=async e=>{if(e.preventDefault(),!m)return;let t=m.categoryId?"PUT":"POST";console.log("Sending category data:",JSON.stringify(m,null,2));try{let e=await fetch("/api/categories",{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));localStorage.removeItem("cachedCategories"),b(),c(!1),u(null)}catch(e){i(e.message),console.error("Failed to save category:",e)}},C=(e,t)=>{let{name:a,value:s}=t.target;u(t=>{if(!t)return null;let l=[...t.options];return l[e]={...l[e],[a]:s},{...t,options:l}})},k=e=>{u(t=>{if(!t)return null;let a=t.options.filter((t,a)=>a!==e);return{...t,options:a}})};return a?(0,s.jsx)(r.A,{}):n?(0,s.jsxs)("div",{children:["Error: ",n]}):(0,s.jsx)("div",{className:"flex flex-col md:flex-row h-screen bg-gray-100 p-4 md:p-6",children:(0,s.jsxs)("div",{className:"flex-1 p-4 md:p-6 overflow-auto",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Manage Categories"}),(0,s.jsx)("button",{onClick:()=>{u({categoryName:"",options:[]}),c(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-md mb-4 hover:bg-blue-700 w-full md:w-auto",children:"Add New Category"}),(0,s.jsx)("div",{className:"bg-white shadow-md rounded-lg p-4 md:p-6 overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category Name"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Options"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:e.categoryName}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500 overflow-hidden text-ellipsis",children:e.options.map(e=>e.optionName).join(", ")}),(0,s.jsxs)("td",{className:"px-6 py-4 text-right text-sm font-medium",children:[(0,s.jsx)("button",{onClick:()=>w(e),className:"text-indigo-600 hover:text-indigo-900 mr-4",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>e.categoryId&&N(e.categoryId),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},e.categoryId))})]})}),d&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex justify-center items-center p-4",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-lg w-full",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:(null==m?void 0:m.categoryId)?"Edit Category":"Add New Category"}),(0,s.jsxs)("form",{onSubmit:v,children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"categoryName",className:"block text-sm font-medium text-gray-700",children:"Category Name"}),(0,s.jsx)("input",{type:"text",id:"categoryName",name:"categoryName",value:(null==m?void 0:m.categoryName)||"",onChange:e=>{let{name:t,value:a}=e.target;u(e=>e?{...e,[t]:a}:null)},className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2",required:!0})]}),(0,s.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Options"}),null==m?void 0:m.options.map((e,t)=>(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row mb-2 items-center w-full",children:[(0,s.jsx)("input",{type:"text",name:"optionName",value:e.optionName||"",onChange:e=>C(t,e),className:"flex-1 border border-gray-300 rounded-md shadow-sm p-2 mr-2 w-full mb-2 sm:mb-0",placeholder:"Option Name",required:!0}),(0,s.jsx)("button",{type:"button",onClick:()=>k(t),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 w-full sm:w-auto",children:"Remove"})]},t)),(0,s.jsx)("button",{type:"button",onClick:()=>{u(e=>e?{...e,options:[...e.options,{optionName:""}]}:null)},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 mb-4 w-full sm:w-auto",children:"Add Option"}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>c(!1),className:"bg-gray-300 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-400 w-full sm:w-auto",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 w-full sm:w-auto",children:"Save Category"})]})]})]})}),g&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex justify-center items-center p-4",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-lg w-full",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"foreignKeyBlocked"===p?"Deletion Blocked":"Confirm Delete"}),(0,s.jsx)("p",{className:"mb-4",children:"foreignKeyBlocked"===p?n:"Are you sure you want to delete this category? This action cannot be undone."}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{x(!1),y(null),f("none"),i(null)},className:"bg-gray-300 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-400 w-full sm:w-auto",children:"Cancel"}),"foreignKeyBlocked"!==p&&(0,s.jsx)("button",{type:"button",onClick:()=>j(!1),className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 w-full sm:w-auto",children:"Delete"})]})]})})]})})}},2058:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var s=a(5155);a(2115);let l=e=>{let{numRows:t=5,numCols:a=3}=e;return(0,s.jsx)("div",{className:"bg-white shadow-md rounded-lg p-4 md:p-6 animate-pulse",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsx)("tr",{children:Array.from({length:a}).map((e,t)=>(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded"})},t))})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:Array.from({length:t}).map((e,t)=>(0,s.jsx)("tr",{children:Array.from({length:a}).map((e,t)=>(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"})},t))},t))})]})})}},4613:(e,t,a)=>{Promise.resolve().then(a.bind(a,1988))}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(4613)),_N_E=e.O()}]);